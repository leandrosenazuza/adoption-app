<div class="estatisticas-container">
  <div *ngIf="isLoading" class="loading">
    <mat-icon class="spinner">hourglass_empty</mat-icon>
    <p>Carregando estatísticas...</p>
  </div>

  <div class="stats-summary" *ngIf="!isLoading">
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Total de Adoções</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-value">
          <mat-icon>favorite</mat-icon>
          <span>{{ getTotalAdocoes() | number:'1.2-2' }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Total de Castrações</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-value">
          <mat-icon>healing</mat-icon>
          <span>{{ getTotalCastracoes() | number:'1.2-2' }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Total de Recolhimentos</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-value">
          <mat-icon>pets</mat-icon>
          <span>{{ getTotalRecolhimentos() | number:'1.2-2' }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Taxa Média de Abandono</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-value">
          <mat-icon>trending_down</mat-icon>
          <span>{{ getMediaTaxaAbandono() | number:'1.2-2' }}%</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="table-card" *ngIf="!isLoading">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>bar_chart</mat-icon>
        Estatísticas por Município
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="dataSource" class="estatisticas-table">
          <ng-container matColumnDef="municipio">
            <th mat-header-cell *matHeaderCellDef> Município </th>
            <td mat-cell *matCellDef="let row"> {{row.municipio}} </td>
          </ng-container>

          <ng-container matColumnDef="adocoesAnuais">
            <th mat-header-cell *matHeaderCellDef> Adoções Anuais </th>
            <td mat-cell *matCellDef="let row"> {{row.adocoesAnuais | number:'1.2-2'}} </td>
          </ng-container>

          <ng-container matColumnDef="castracoesAnuais">
            <th mat-header-cell *matHeaderCellDef> Castrações Anuais </th>
            <td mat-cell *matCellDef="let row"> {{row.castracoesAnuais | number:'1.2-2'}} </td>
          </ng-container>

          <ng-container matColumnDef="recolhimentos">
            <th mat-header-cell *matHeaderCellDef> Recolhimentos </th>
            <td mat-cell *matCellDef="let row"> {{row.recolhimentos | number:'1.2-2'}} </td>
          </ng-container>

          <ng-container matColumnDef="taxaAbandono">
            <th mat-header-cell *matHeaderCellDef> Taxa de Abandono (%) </th>
            <td mat-cell *matCellDef="let row"> {{row.taxaAbandono | number:'1.2-2'}}% </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
